language: go
sudo: false
matrix:
  include:
    - go: 1.x
      env: LATEST=true
    - go: 1.9
    - go: "1.10"
    - go: tip
  allow_failures:
    - go: tip

before_install:
  - go get github.com/mitchellh/gox

install:
  - # skip

script:
  - go get -t -v ./...
  #- diff -u <(echo -n) <(gofmt -d .)
  - go vet $(go list ./... | grep -v vendor/)
  - go test -v -race -cover ./...
  # Only build binaries from the latest Go release.
  - if [ "${LATEST}" = "true" ]; then gox -os="linux darwin windows" -arch="amd64" -output="gdhk.{{.OS}}.{{.Arch}}" -ldflags "-X main.version=`git rev-parse --short HEAD`" -verbose ./...; fi

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: "sItO+tJTzvgeSC/UFAfHSXhUoTqe7U3b5+4eohwrY9SrCqEdizsmQ3CdhRqJFoaXtAvapug1WwgcFaDciXcPwcczyFRuK8ED31jmDpgDEp7H+xrf4LArhBjrwqLt3+v4MYQMYfpSBKk7qV+17HD9CeqNCbkbwGwq/RXXDE9WqZ+ki6MshQk8gyg+6EBExSOnUbRLsOL69gXKrDNFT9RZZKpiHTwWQ3HE17TGRgOe8YV3QvL7PMkClr6UZ0yjrtyx90hx+aLBFBujO+Z6+A4Wq37OAkmi/HZ8M0gxxu56LwVYbwlmY9JC40+ZWRL1+z6l8HOO7o6okpwvdgqHHFSXkNi5QHEVkGMSLVI4tSZ+TyAll5q541cOI/1fTYaRCxDX9PuVi/LxLoeIss1G+8mw2d94sq59cWNPdxC5wRqofECjGRBKtTYHWt88oNoRKiduAr9TYborl8B30ZGCcqVK2eaV342E4ORHBfp9YSxtiUI8ytet1Sd5RVlenl7RiCPk6dsXHjBplC5bEBiOJzYx0uLijc/DQG9cANyJE3CJVxJxYHn7l5CKWoj4dYpvl5NepL3rTW38llVHhdMWLUPU3fFnk036eaC9kKR0SisDJfpeufTUUXHtgjrgYFThigiVw3TpfkwlfAzL/IV4fEJ/sw2xO5KJgLRF6KkmDKSiGrw="
  file:
  - gdhk.windows.amd64.exe
  - gdhk.darwin.amd64
  - gdhk.linux.amd64
  on:
    repo: forfuncsake/garagedoor
    tags: true
    condition: $LATEST = true